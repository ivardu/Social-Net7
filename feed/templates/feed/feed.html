{% extends 'users/base.html' %}
{% load crispy_forms_tags %}
{% block search %}
<li class="nav-item">
    <form class="form-inline my-2 my-lg-0" method="post" action="{% url 'search'%}">
    	{% csrf_token %}
      <input type="search" class="form-control mr-sm-2" name="search" placeholder="Search People, Friends" aria-label="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
</li>
{% endblock search %}
{% block body %}
<div class="container w-25 shadow-lg p-3 ">
	<form method='post' enctype='multipart/form-data'>
		{% csrf_token %}
		{{feed_form|crispy }}
		<div align="center">
			<input class="btn btn-primary w-100" type="submit" name="submit" value="Post">
		</div>
	</form>
</div>
<div class="container">
	{% for item in feed %}
		<div class="row container shadow-lg p-2 mt-2 rounded w-50 mx-auto ">
			<div class="col-md-2">
				<img class="img-thumbnail rounded-circle" src="{{item.user.profile.image.url}}" width="50" height="50">
			</div>
			<div class="col-md-9">
				<!-- Feed Post User Details -->
				<div class="row">
				{% if item.user == request.user %}
					{% if item.user.fname_empty %}
					<small><a href="{% url 'profile' %}">{{item.user.truncate|title}}</a></small>
					{% else %}
					<small><a href="{% url 'profile' %}">{{item.user.first_name}} {{item.user.last_name}}</a></small>
					{% endif %}
				{% else %}
					{% if item.user.fname_empty %}
					<small><a href="{% url 'rprofile' item.user.id %}">{{item.user.truncate|title}}</a></small>
					{% else %}
					<small><a href="{% url 'rprofile' item.user.id %}">{{item.user.first_name}} {{item.user.last_name}}</a></small>
					{% endif %}
				{% endif %}
				</div>
				<div class="row">
					<small>{{item.user.email}}</small>
				</div>
				<!-- Feed post info or about the post -->
				<div class="row mt-2 mb-1">
					<small>{{item.post_info}}</small>
				</div>
				<!-- Feed Post image section -->
				<div class="row">
					<img src="{{item.image.url}}" width="400" height="400">
				</div>
				<!-- Likes Section -->
				<div class="row">
					<form method="post" action="{% url 'feed:likes' item.id %}">
						{% csrf_token %}
						<input type="hidden" name="likes" value="1">
					 	<input class="btn btn-link" type="submit" name="submit" value="Likes"><small>{{item.likes_count}}</small>
					 </form>
				</div>
				<!-- Comments Section -->
				<div class="row mx-auto">
					<form class="form-inline" action="{% url 'feed:comments' item.id %}" method="post">
						{% csrf_token %}
						<div class="form-group">
							{{comment_form}}
							<input class="btn btn-sm btn-success" type="submit" name="submit" value="comment">
						</div>
					</form>
				</div>
				<!-- Commments List Section -->
				<div class="pl-0">
					{% if item.comments_set.all %}
					<!-- <ul class="list-group"> -->
						{% for item in item.comments_set.all %}
						<hr class="p-0 m-0 b-light">
							{% if item.user == request.user %}
								{% if item.user.fname_empty %}
								<small><a href="{% url 'profile' %}">{{item.user.truncate|title}} </a>{{item.comments}}</small>
								{% else %}
									<small><a href="{% url 'profile'%}">{{item.user.first_name|title}} </a> {{item.comments}}</small>
								{% endif %}
							{% else %}
								{% if item.user.fname_empty %}
								<small><a href="{% url 'rprofile' item.user.id %}">{{item.user.truncate|title}}</a> {{item.comments}}</small>
								{% else %}
									<small><a href="{% url 'rprofile' item.user.id %}">{{item.user.first_name|title}}</a> {{item.comments}}</small>
								{% endif %}
							{% endif %}
						{% endfor %}
					<!-- </ul> -->
					{% endif %}
					
				</div>
			</div>
		</div>
	{% endfor %}
</div>
<div class="container mt-2 p-3" align="center">
		{% if page_obj.has_previous %}
				<small><a class="btn btn-outline-info" href="?page=1">Prev</a></small>
		{% endif %}
		{% for num in paginator.page_range %}
			{% if num == page_obj.number %}
				<small><a class="btn btn-info" href="?page={{num}}">{{num}}</a></small>
			{% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'+3' %}
				<small><a class="btn btn-outline-info" href="?page={{num}}">{{num}}</a></small>
			{% endif %}
		{% endfor %}
		{% if page_obj.has_next %}
			<small><a class="btn btn-outline-info" href="?page={{paginator.num_pages}}">Last</a></small>
		{% endif %}
</div>

{% endblock body %}