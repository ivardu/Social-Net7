{% extends 'users/base.html' %}
{% load crispy_forms_tags %}
{% load static%}
{% block body %}
<div class="container shadow-lg p-3 col-md-4">
	<div class="row">
		<div class="col-sm-11 offset-sm-1 text-center">
			<form method='post' class="justify-content-center" enctype='multipart/form-data'>
				{% csrf_token %}
					
						<div class="row">
							{{feed_form.post_info}}
						</div>
						<div class="row p-1">
							<img id='fi_disp' src="#" alt="Your image">
						</div>
						<div class="row p-1">
							<div class="col-sm-3 image-upload" align="center">
								<label for='id_image'>
									<img id="up_image" src="{% static 'components/Image_upload.png' %}" width="30" height="30">
								</label>
								{{feed_form.image}}
								<input class="btn btn-primary w-100" type="submit" name="submit" value="Post">
							</div>
							<div class="col-sm-8">
								<input class="btn btn-primary w-100" type="submit" name="submit" value="Post">
							</div>
						</div>
					
			</form>
		</div>
	</div>
</div>
<div class="container">
	{% for item in page_obj %}
		{% if item.user.id in request.user.frn_list_ids or item.user == request.user %}
		<!-- <h1>{{item.id}}</h1> -->
		<div class="row container shadow-lg p-2 mt-2 rounded w-50 mx-auto ">
			<div class="col-md-2">
				<img class="img-thumbnail rounded-circle" src="{{item.user.profile.image.url}}" width="50" height="50">
			</div>
			<div class="col-md-9">
				<!-- Feed Post User Details -->
				<div class="row">
				{% if item.user == request.user %}
					<div class="col-sm-10 pl-0">
						{% if item.user.fname_empty %}
						<small><a href="{% url 'profile' %}">{{item.user.truncate|title}}</a></small>
						{% else %}
						<small><a href="{% url 'profile' %}">{{item.user.first_name}} {{item.user.last_name}}</a></small>
						{% endif %}
					</div>
				{% else %}
					{% if item.user.fname_empty %}
					<small><a href="{% url 'rprofile' item.user.id %}">{{item.user.truncate|title}}</a></small>
					{% else %}
					<small><a href="{% url 'rprofile' item.user.id %}">{{item.user.first_name}} {{item.user.last_name}}</a></small>
					{% endif %}
				{% endif %}
				</div>
				<!-- Feed Post User Email  -->
<!-- 				<div class="row">
					<small>{{item.user.email}}</small>
				</div> -->
				<!--  Feed Post timeline  -->
				<div class="row">
					<h6 class="small">{{item.feed_post_time}}</h6>
					<!-- <span class="small">{{item.date}}</span> -->
				</div>
				<!-- Feed post info or about the post -->
				<div class="row mt-2 mb-1">
					<small>{{item.post_info}}</small>
				</div>
				<!-- Feed Post image section -->
				<div class="row">
					<img src="{{item.image.url}}" width="400" height="400">
				</div>
				<!-- Likes Section -->
				<div class="row mx-auto">
					<form method="post" class='likes_form' likes-url="{% url 'feed:likes' item.id %}">
						{% csrf_token %}
						<input type="hidden" name="likes" value="1">
						<input class="likes_btn btn btn-sm btn-link pl-0 pt-0" type="submit" name="submit" value="Likes"><span class="likes_value small">{{item.likes_count}}</span>
					</form>
				</div>
				<!-- Comments Section -->
				<div class="row mx-auto">
					<form class="comment_form" comment-url="{% url 'feed:comments' item.id %}" method="post">
						{% csrf_token %}
						<div class="form-group form-inline mb-0">
							{{comment_form}}
							<input class="btn btn-sm btn-success" type="submit" name="submit" value="comment">
						</div>
					</form>
				</div>
				<!-- Commments List Section -->
				<div class="pl-0">
					<ul class="list-group list-group-flush" id=Feed{{item.id}}>
					{% if item.comments_set.all %}
						{% for item in item.comments_set.all %}
						<li class="list-group-item p-0">
							<!-- <hr class="p-0 m-0 b-light"> -->
							{% if item.user == request.user %}
								{% if item.user.fname_empty %}
								<small><a href="{% url 'profile' %}">{{item.user.truncate|title}} </a>{{item.comments}}</small>
								{% else %}
									<small><a href="{% url 'profile'%}">{{item.user.first_name|title}} </a> {{item.comments}}</small>
								{% endif %}
							{% else %}
								{% if item.user.fname_empty %}
								<small><a href="{% url 'rprofile' item.user.id %}">{{item.user.truncate|title}}</a> {{item.comments}}</small>
								{% else %}
									<small><a href="{% url 'rprofile' item.user.id %}">{{item.user.first_name|title}}</a> {{item.comments}}</small>
								{% endif %}
							{% endif %}
						</li>
						{% endfor %}	
					{% endif %}
					</ul>
				</div>
			</div>
			<!-- Feed edit -->
			<div class="col-md-1">
				{% if item.user == request.user %}
				<div class="dropleft">
					<a href='' class="test text-decoration-none" id="dropdownMenuButton" data-toggle="dropdown">
					</a>
					<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
					 <a class="dropdown-item small" href="{% url 'feed:feed_edit' item.id %}">Edit</a>
					 <a class="dropdown-item small" href="{% url 'feed:feed_del' item.id %}">Delete</a>
					</div>
				 </div>
				{% endif %}
			</div>
		</div>
		{% endif %}
	{% endfor %}
</div>
<div class="container mt-2 p-3" align="center">
<!-- {{page_obj}}
{{paginator.page_range}} -->
{% if page_obj %}
		{% if page_obj.has_previous %}
				<small><a class="btn btn-outline-info" href="?page=1">Prev</a></small>
		{% endif %}
		{% for num in paginator.page_range %}
			{% if num == page_obj.number and paginator.num_pages == 1 %}
				<small><a class="btn btn-secondary" href="#"><<</a> <a class="btn btn-info" href="?page={{num}}">{{num}}</a> <a class="btn btn-secondary" href="#">>></a></small>
			{% elif num == page_obj.number %}
				<small><a class="btn btn-info" href="?page={{num}}">{{num}}</a></small>
			{% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'+3' %}
				<small><a class="btn btn-outline-info" href="?page={{num}}">{{num}}</a></small>
			{% endif %}
		{% endfor %}
		{% if page_obj.has_next %}
			<small><a class="btn btn-outline-info" href="?page={{paginator.num_pages}}">Last</a></small>
		{% endif %}
{% endif %}
</div>

{% endblock body %}
{% block script %}
<script type="text/javascript">
function readURL() {
	//	rehide the image and remove its current "src",
	//	this way if the new image doesn't load,
	//	then the image element is "gone" for now
	$('#fi_disp').attr('src', '').hide();
	if (this.files && this.files[0]) {
		var reader = new FileReader();
		$(reader).load(function(e) {
			$('#fi_disp')
				//	first we set the attribute of "src" thus changing the image link
				.attr('src', e.target.result)	//	this will now call the load event on the image
		});
		reader.readAsDataURL(this.files[0]);
	}
}

//	below makes use of jQuery chaining. This means the same element is returned after each method, so we don't need to call it again
$('#fi_disp')
	//	here we first set a "load" event for the image that will cause it change it's height to a set variable
	//		and make it "show" when finished loading
	.load(function(e) {
		//	$(this) is the jQuery OBJECT of this which is the element we've called on this load method
		$(this)
			//	note how easy adding css is, just create an object of the css you want to change or a key/value pair of STRINGS
			.css('height', '400px')	//	or .css({ height: '200px' })
			//	now for the next "method" in the chain, we show the image when loaded
			.show();	//	just that simple
		$(this).css('width', '400px').show();
	})
	//	with the load event set, we now hide the image as it has nothing in it to start with
	.hide();	//	done

$("#id_image").change(readURL);
</script>
<script type="text/javascript">
$('#id_post_info').click(function(){
	$('#id_post_info').css({
		'height':'75px',
	});
});
</script>
{% endblock script %}